{"ast":null,"code":"import _regeneratorRuntime from\"C:/sviluppo/progetti-react/otter-guardian-authenticator/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/sviluppo/progetti-react/otter-guardian-authenticator/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/sviluppo/progetti-react/otter-guardian-authenticator/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{useDispatch,useSelector}from'react-redux';import{Link,useNavigate}from'react-router-dom';import{fetchIsLoadingAction}from'../modules/feedback/actions';import autenticazioneService from'../services/AutenticazioneService';import{toast}from'react-toastify';import{QrReader}from'react-qr-reader';import{configurazione}from'../configurazione';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ScansioneQrCodePage(){var dispatch=useDispatch();var feedback=useSelector(function(state){return state.feedback;});var idDispositivoFisico=useSelector(function(state){return state.utenteLoggato.idDispositivoFisico;});var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),idQrCode=_React$useState2[0],setIdQrCode=_React$useState2[1];var navigate=useNavigate();var autorizzaQrCode=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var jsonBody;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:jsonBody={idQrCode:idQrCode,idDispositivoFisico:idDispositivoFisico};_context.next=3;return autenticazioneService.autorizzaQrCode(jsonBody).then(function(response){toast.success('Accesso avvenuto con successo!',{position:\"top-center\",autoClose:5000});navigate(\"/\");}).catch(function(e){//---------------------------------------------\ntry{console.error(e);toast.error(e.response.data.descrizione,{position:\"top-center\",autoClose:5000});}catch(e){toast.error(\"Errore imprevisto\",{position:\"top-center\",autoClose:5000});}if(e.response.status===401){navigate(\"/logout\");}//---------------------------------------------\n});case 3:case\"end\":return _context.stop();}}},_callee);}));return function autorizzaQrCode(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-lg-5 text-center mx-auto\",children:[/*#__PURE__*/_jsx(\"h1\",{onClick:function onClick(){return dispatch(fetchIsLoadingAction(false));},className:\" mb-2 mt-5\",children:/*#__PURE__*/_jsx(\"i\",{className:configurazione.icona+\" text-primary\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lead\",children:configurazione.nomeApplicativo})]})})}),feedback.isLoading&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"main\",{className:\"main-content  mt-0\",children:/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"page-header min-vh-70\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12 text-center\",children:/*#__PURE__*/_jsx(\"i\",{className:\"text-primary fa-3x fa-solid fa-spinner fast-spin fa-spin\"})})})})})})})}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content  mt-0\",children:/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"page-header min-vh-70\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"shadow-lg bg-white rounded col-xl-4 col-lg-4 col-md-8 d-flex flex-column mx-0 mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card shadow-lg card-plain\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header bg-transparent pb-0 text-start\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-weight-bolder\",children:\"Accedi\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-0\",children:\"Scansiona il QrCode per proseguire\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(QrReader,{scanDelay:500,onResult:function onResult(result,error){if(!!result){setIdQrCode(result===null||result===void 0?void 0:result.getText());}if(!!error){//console.info(error);\n}},constraints:{facingMode:'environment'}}),idQrCode&&/*#__PURE__*/_jsx(\"div\",{className:\"row d-flex align-items-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12 pt-3\",children:/*#__PURE__*/_jsx(\"span\",{onClick:autorizzaQrCode,className:\"btn btn-lg btn-primary btn-lg w-100 mb-0\",children:\"Accedi\"})})})]}),/*#__PURE__*/_jsx(\"hr\",{className:\"bg-dark\"}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body mx-0 pt-0 \",children:/*#__PURE__*/_jsx(\"div\",{className:\"row d-flex align-items-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-12 text-center\",children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-lg btn-primary btn-lg w-100 mb-0\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"cursor-pointer fa-solid fa-arrow-rotate-left fa-2x pe-2\"}),\"Indietro\"]})})})})})]})})})})})})})]});}","map":{"version":3,"names":["React","useDispatch","useSelector","Link","useNavigate","fetchIsLoadingAction","autenticazioneService","toast","QrReader","configurazione","ScansioneQrCodePage","dispatch","feedback","state","idDispositivoFisico","utenteLoggato","useState","idQrCode","setIdQrCode","navigate","autorizzaQrCode","jsonBody","then","response","success","position","autoClose","catch","e","console","error","data","descrizione","status","icona","nomeApplicativo","isLoading","result","getText","facingMode"],"sources":["C:/sviluppo/progetti-react/otter-guardian-authenticator/src/pages/ScansioneQrCodePage.tsx"],"sourcesContent":["import React from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { LoginInterface } from '../interfaces/LoginInterface';\r\nimport { fetchTestoDangerAction, fetchIsLoadingAction } from '../modules/feedback/actions';\r\nimport { fetchIdDispositivoFisicoAction, fetchTokenAction, resetUtenteAction } from '../modules/utenteLoggato/actions';\r\nimport QRCode from \"react-qr-code\";\r\nimport autenticazioneService from '../services/AutenticazioneService';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport { QrReader } from 'react-qr-reader';\r\nimport { isLoading } from '../modules/feedback/selector';\r\nimport { configurazione } from '../configurazione';\r\n\r\n\r\n\r\nexport default function ScansioneQrCodePage() {\r\n    const dispatch = useDispatch();\r\n    const feedback = useSelector((state: any) => state.feedback);\r\n    const idDispositivoFisico = useSelector((state: any) => state.utenteLoggato.idDispositivoFisico);\r\n\r\n\r\n\r\n    const [idQrCode, setIdQrCode] = React.useState(\"\");\r\n\r\n\r\n    let navigate = useNavigate();\r\n\r\n\r\n\r\n    const autorizzaQrCode = async () => {\r\n\r\n\r\n        let jsonBody: any = {\r\n            idQrCode: idQrCode,\r\n            idDispositivoFisico: idDispositivoFisico,\r\n        }\r\n\r\n        await autenticazioneService.autorizzaQrCode(jsonBody).then(response => {\r\n            toast.success('Accesso avvenuto con successo!', {\r\n                position: \"top-center\",\r\n                autoClose: 5000,\r\n            });\r\n            navigate(\"/\");\r\n\r\n        }).catch(e => {\r\n            //---------------------------------------------\r\n            try {\r\n                console.error(e);\r\n                toast.error(e.response.data.descrizione, {\r\n                    position: \"top-center\",\r\n                    autoClose: 5000,\r\n                });\r\n            } catch (e: any) {\r\n                toast.error(\"Errore imprevisto\", {\r\n                    position: \"top-center\",\r\n                    autoClose: 5000,\r\n                });\r\n            }\r\n            if (e.response.status === 401) {\r\n                navigate(\"/logout\");\r\n            }\r\n            //---------------------------------------------\r\n        });\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    return (\r\n        <>\r\n            <div className=\"container\">\r\n                <div className=\"row justify-content-center\">\r\n                    <div className=\"col-lg-5 text-center mx-auto\">\r\n                        <h1 onClick={() => dispatch(fetchIsLoadingAction(false))} className=\" mb-2 mt-5\"><i className={configurazione.icona + \" text-primary\"}></i></h1>\r\n                        <p className=\"text-lead\">{configurazione.nomeApplicativo}</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            {feedback.isLoading &&\r\n                <>\r\n                    <main className=\"main-content  mt-0\">\r\n                        <section>\r\n                            <div className=\"page-header min-vh-70\">\r\n                                <div className=\"container\">\r\n                                    <div className=\"row\">\r\n                                        <div className='col-12 text-center'>\r\n                                            <i className=\"text-primary fa-3x fa-solid fa-spinner fast-spin fa-spin\"></i>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </section>\r\n                    </main>\r\n                </>\r\n            }\r\n\r\n\r\n\r\n            {\r\n                <main className=\"main-content  mt-0\">\r\n                    <section>\r\n                        <div className=\"page-header min-vh-70\">\r\n                            <div className=\"container\">\r\n                                <div className=\"row\">\r\n                                    <div className=\"shadow-lg bg-white rounded col-xl-4 col-lg-4 col-md-8 d-flex flex-column mx-0 mx-auto\">\r\n                                        <div className=\"card shadow-lg card-plain\">\r\n                                            <div className=\"card-header bg-transparent pb-0 text-start\">\r\n                                                <h4 className=\"font-weight-bolder\">Accedi</h4>\r\n                                                <p className=\"mb-0\">Scansiona il QrCode per proseguire</p>\r\n                                            </div>\r\n                                            <div className=\"card-body\">\r\n                                                <QrReader\r\n                                                    scanDelay={500}\r\n                                                    onResult={(result, error) => {\r\n                                                        if (!!result) {\r\n                                                            setIdQrCode(result?.getText());\r\n                                                        }\r\n\r\n                                                        if (!!error) {\r\n                                                            //console.info(error);\r\n                                                        }\r\n                                                    }}\r\n                                                    constraints={{\r\n                                                        facingMode: 'environment'\r\n                                                    }}\r\n                                                />\r\n                                                {idQrCode &&\r\n                                                    <div className='row d-flex align-items-center'>\r\n\r\n                                                        <div className='col-12 pt-3'>\r\n                                                            <span onClick={autorizzaQrCode} className=\"btn btn-lg btn-primary btn-lg w-100 mb-0\" >Accedi</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                }\r\n                                            </div>\r\n                                            <hr className='bg-dark' />\r\n                                            <div className=\"card-body mx-0 pt-0 \">\r\n\r\n                                                <div className='row d-flex align-items-center'>\r\n                                                    <div className='col-12 text-center'>\r\n                                                        <Link to=\"/\" ><span className=\"btn btn-lg btn-primary btn-lg w-100 mb-0\"><i className=\"cursor-pointer fa-solid fa-arrow-rotate-left fa-2x pe-2\"></i>Indietro</span></Link>\r\n                                                    </div>\r\n\r\n                                                </div>\r\n\r\n                                            </div>\r\n\r\n\r\n\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n                </main>\r\n            }\r\n\r\n\r\n        </>\r\n    );\r\n\r\n}\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}